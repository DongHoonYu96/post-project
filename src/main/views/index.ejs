<head>
    <meta charset="UTF-8">
    <title>Title</title>
    <link rel="stylesheet" href="../css/main.css">
</head>

<body>

<nav class="navbar">
    <a href="/">HELLO. WEB!</a>
    <ul class="nav-item-box">
        <% if (typeof member !== 'undefined' && member !== null) { %>
            <li>
                <button onclick="location.href='/user/list'" class="button BoldS">
                    <p>멤버리스트</p>
                </button>
            </li>
            <li>
                <button onclick="location.href='/user/mypage'" class="button BoldS">
                    <p>마이페이지</p>
                </button>
            </li>
            <li>
                <button onclick="location.href='/user/logout'" class="button BoldS">
                    <p>로그아웃</p>
                </button>
            </li>
        <% } else { %>
            <li>
                <button onclick="location.href='/user/login/form'" class="button BoldS">
                    <p>로그인/회원가입</p>
                </button>
            </li>
        <% } %>
    </ul>
</nav>

<section class="hero-box">
    <p class="hero-subtitle">부스트캠프 백엔드 교육용 페이지
    <h1 class="hero-title">HELLO.
        <% if (typeof member !== 'undefined' && member !== null) { %>
            <%= member.nickname %>
        <% } else { %>
            GUEST
        <% } %>
        !</h1>
    </p>
</section>

<section class="board-box">
    <p class="board-count">전체글 <span><%=data.total%></span>개</p>
    <ul class="board-list">
        <li class="board-header">
            <div>
                <p class="board-header-title BordS">제목</p>
                <p class="board-header-author BordS">작성자</p>
                <p class="board-header-date BordS">작성일자</p>
                <p class="board-header-views BordS">조회수</p>
            </div>
        <li class="board-item">
            <% posts.forEach(function(post) { %>
                <a href="/post/<%= post.id %>" class="board-link">
                    <p class="board-item-title BordR"><%= post.title%></p>
                    <p class="board-item-author BordR"><%= post.member.nickname%></p>
                    <p class="board-item-date BordR"><%= post.createdAt.toLocaleString()%></p>
                    <p class="board-item-views BordR"><%= post.views%></p>
                </a>
            <% }); %>
        </li>
    </ul>

    <%
    function generatePagination(currentPage, totalPages, displayRange = 5) {
        let start = Math.max(1, currentPage - Math.floor(displayRange / 2));
        let end = Math.min(totalPages, start + displayRange - 1);
        start = Math.max(1, end - displayRange + 1);

        let pages = [];
        if (start > 1) {
            pages.push(1);
            if (start > 2) pages.push('...');
        }
        for (let i = start; i <= end; i++) {
            pages.push(i);
        }
        if (end < totalPages) {
            if (end < totalPages - 1) pages.push('...');
            pages.push(totalPages);
        }
        return pages;
    }

    const currentPage = parseInt(curPage.curPage) || 1;
    const totalPages = Math.ceil(data.total / 10);
    const pages = generatePagination(currentPage, totalPages);
    %>

    <nav class="navbar">
        <div class="pagination">
            <% if (currentPage > 1) { %>
                <a href="/post?page=<%= currentPage - 1 %>" class="page-link">&laquo; Previous</a>
            <% } %>

            <% pages.forEach(page => { %>
                <% if (page === '...') { %>
                    <span class="page-link">...</span>
                <% } else if (page === currentPage) { %>
                    <span class="page-link current"><%= page %></span>
                <% } else { %>
                    <a href="/post?page=<%= page %>" class="page-link"><%= page %></a>
                <% } %>
            <% }); %>

            <% if (currentPage < totalPages) { %>
                <a href="/post?page=<%= currentPage + 1 %>" class="page-link">Next &raquo;</a>
            <% } %>
        </div>

        <div class="nav-actions">
            <div class="search-box">
                <input type="text" placeholder="검색어를 입력하세요" class="search-input">
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" width="24" height="24">
                    <path fill="none" stroke="currentColor" stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15.5 15.5L20 20M10 17a7 7 0 100-14 7 7 0 000 14z"/>
                </svg>
            </div>
            <button onclick="location.href='/post/form'" class="action-button">
                글쓰기
            </button>
        </div>
    </nav>
</body>

</html>